<!DOCTYPE html>
<html>
<head>

<meta charset="utf-8">
<title>baser.ui.element.FormElement</title>
<link rel="stylesheet" href="../node_modules/qunitjs/qunit/qunit.css">

</head>
<body>

<div id="qunit"></div>
<div id="qunit-fixture">
	<input id="target" type="text">
	<label>beforeLabelText<input id="target-wrapped-label" type="text">afterLabelText</label>
	<input id="target-with-label" type="text"><label for="target-with-label">withLabel</label>
	<input id="target-default-value" type="text" value="default-value">
	<input id="target-disabled" type="text" disabled>
</div>

<!-- Libraries -->
<script src="../bower_components/jquery/dist/jquery.js"></script>

<!-- Core Module -->
<script src="../baser.js"></script>

<!-- Qunit -->
<script src="../node_modules/qunitjs/qunit/qunit.js"></script>

<!-- Test Code -->
<script>
"use strict";

test('付加クラス', function() {
	expect(10);

	var $target = $('#target');

	var target = new baser.ui.element.FormElement($target);

	ok(target.$el.parent('span').hasClass('-bc-form-element'), 'ラッパー要素のクラス');
	ok(target.$el.parent('span').hasClass('-bc-wrapper'), 'ラッパー要素のクラス');
	ok(target.$el.parent('span').hasClass('-bc-wrapper--blur'), 'ラッパー要素のクラス ブラー状態');
	ok(target.$el.hasClass('-bc-element'), '本体のクラス');
	ok(target.$el.hasClass('-bc-form-element'), '本体のクラス');
	ok(target.$el.hasClass('-bc-form-element--blur'), '本体のクラス ブラー状態');

	target.$el.on('focus', function () {
		var $this = $(this);
		ok(!$this.parent('span').hasClass('-bc-wrapper--blur'), 'ラッパー要素のクラス ブラー状態解除');
		ok($this.parent('span').hasClass('-bc-wrapper--focus'), 'ラッパー要素のクラス フォーカス状態');
		ok(!$this.hasClass('-bc-form-element--blur'), '本体のクラス ブラー状態解除');
		ok($this.hasClass('-bc-form-element--focus'), '本体のクラス フォーカス状態');
	});

	target.$el.trigger('focus');

});

test('ラベルテスト', function() {

	var $target = $('#target-wrapped-label');

	var target = new baser.ui.element.FormElement($target);

	ok(target.$label.hasClass('-bc-form-element'), 'ラベル要素のクラス');
	ok(target.$label.hasClass('-bc-form-element__label'), 'ラベル要素のクラス');

	ok(target.isWrappedByLabel, 'ラベルがラップされている');

	equal(target.label, 'beforeLabelTextafterLabelText', 'ラベルのテキスト');

});

test('ラベルテスト2', function() {

	var $target = $('#target-wrapped-label');

	var target = new baser.ui.element.FormElement($target, {
		label: 'labelFromOption'
	});

	equal(target.label, 'labelFromOption', 'ラベルのテキスト');

});

test('ラベルテスト3', function() {

	var $target = $('#target-with-label');

	var target = new baser.ui.element.FormElement($target);

	ok(target.$label.hasClass('-bc-form-element'), 'ラベル要素のクラス');
	ok(target.$label.hasClass('-bc-form-element__label'), 'ラベル要素のクラス');

	ok(!target.isWrappedByLabel, 'ラベルがラップされていない');

	equal(target.label, 'withLabel', 'ラベルのテキスト');

});

test('ラベルテスト4', function() {

	var $target = $('#target-with-label');

	var target = new baser.ui.element.FormElement($target, {
		label: 'labelFromOption'
	});

	equal(target.label, 'labelFromOption', 'ラベルのテキスト');

});

test('disabled 状態取得', function() {
	expect(2);

	var $target = $('#target-disabled');

	var target = new baser.ui.element.FormElement($target);

	ok(target.disabled, 'disabled is true');
	ok(target.$el.hasClass('-bc-form-element--disabled'), '本体のクラス 無効状態');

	// フォーカスできない
	target.$el.on('focus', function () {
		ok(true); // このOKにたどりつかないはず
	});

	target.$el.trigger('focus');

});

test('disabled 状態変更', function() {
	expect(5);

	var $target = $('#target-disabled');

	var target = new baser.ui.element.FormElement($target);

	ok(target.disabled, 'disabled is true');
	ok(target.$el.hasClass('-bc-form-element--disabled'), '本体のクラス 無効状態');

	target.setDisabled(false);

	ok(!target.disabled, 'disabled is false after changed');

	// フォーカスできる
	target.$el.on('focus', function () {
		var $this = $(this);
		ok(true, 'focus success'); // このOKにたどりつける
		ok(!$this.hasClass('-bc-form-element--disabled'), '本体のクラス 無効状態 解除');
	});

	target.$el.trigger('focus');

});

test('baser.ui.element.FormElementの後方互換テスト(v0.0.x)', function() {
	expect(4);

	var $target = $('#target');

	// v0.0.xの設定 設定は要素を new する以前に必要
	baser.ui.element.Element.classNameDefaultSeparatorForModifier = baser.ui.element.ClassNameSeparatorForBEM.HYPHEN;
	baser.ui.element.FormElement.classNameWrapper = 'form-element-wrapper';

	var target = new baser.ui.element.FormElement($target);

	ok(target.$el.hasClass('-bc-form-element'), '本体のクラス');
	ok(target.$el.hasClass('-bc-form-element-blur'), 'blurクラス');
	ok(target.$el.parent().hasClass('-bc-form-element-wrapper'), 'ラッパー要素のクラス');

	target.$el.on('focus', function() {
		var $this = $(this);
		ok($this.hasClass('-bc-form-element-focus'), 'focusクラス');
	});

	target.$el.trigger('focus');

});

</script>

</body>
</html>
