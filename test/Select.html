<!DOCTYPE html>
<html>
<head>

<meta charset="utf-8">
<title>baser.Select</title>
<link rel="stylesheet" href="../node_modules/qunitjs/qunit/qunit.css">

</head>
<body>

<div id="qunit"></div>
<div id="qunit-fixture">
	<select id="target">
		<option value="value1">text1</option>
		<option value="value2">text2</option>
		<option value="value3">text3</option>
	</select>
	<label>beforeLabelText<select id="target-wrapped-label">
			<option value="value1">text1</option>
			<option value="value2">text2</option>
			<option value="value3">text3</option>
		</select>afterLabelText</label>
	<select id="target-with-label">
		<option value="value1">text1</option>
		<option value="value2">text2</option>
		<option value="value3">text3</option>
	</select>
	<label for="target-with-label">withLabel</label>
	<select id="target-title-label" title="title-label">
		<option value="value1">text1</option>
		<option value="value2">text2</option>
		<option value="value3">text3</option>
	</select>
	<select id="target-default-value">
		<option value="value1">value1</option>
		<option value="default-value" selected>default-value</option>
		<option value="value3">value3</option>
	</select>
	<select id="target-disabled" disabled>
		<option value="value1">text1</option>
		<option value="value2">text2</option>
		<option value="value3">text3</option>
	</select>
	<select name="target-empty" id="empty"></select>
</div>

<!-- Libraries -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>

<!-- Core Module -->
<script src="../dist/baser.js"></script>

<!-- Qunit -->
<script src="../node_modules/qunitjs/qunit/qunit.js"></script>

<!-- Test Code -->
<script>
"use strict";

QUnit.test('added class names', function (assert) {
	assert.expect(10);

	var $target = $('#target');

	var target = new baser.Select($target[0]);

	assert.ok($(target.el).parent('span').hasClass('-bc-form-element'), 'class name of wrapper');
	assert.ok($(target.el).parent('span').hasClass('-bc-wrapper'), 'class name of wrapper');
	assert.ok($(target.el).parent('span').hasClass('-bc-wrapper--blur'), 'class name of wrapper on blur');
	assert.ok($(target.el).hasClass('-bc-element'), 'class name of this element');
	assert.ok($(target.el).hasClass('-bc-form-element'), 'class name of this element');
	assert.ok($(target.el).hasClass('-bc-form-element--blur'), 'class name of this element on blur');

	$(target.el).on('focus', function () {
		var $this = $(this);
		assert.ok(!$this.parent('span').hasClass('-bc-wrapper--blur'), 'removed check blur class name of wrapper');
		assert.ok($this.parent('span').hasClass('-bc-wrapper--focus'), 'class name of wrapper on focus');
		assert.ok(!$this.hasClass('-bc-form-element--blur'), 'removed check blur class name of this element');
		assert.ok($this.hasClass('-bc-form-element--focus'), 'class name of this element on focus');
	});

	$(target.el).trigger('focus');

	// console.log(target);
	// console.log(target.$wrapper.attr('class'));
	// console.log($(target.el).attr('class'));
	// console.log($(target.label).attr('class'));
	// console.log(target.$pseudo.attr('class'));
	// console.log(target.$selected.attr('class'));
	// console.log(target.$options.attr('class'));

});

QUnit.test('wrapped label', function (assert) {
	assert.expect(4);

	var $target = $('#target-wrapped-label');

	var target = new baser.Select($target[0]);

	assert.ok($(target.label).hasClass('-bc-form-element'), 'class name of label element');
	assert.ok($(target.label).hasClass('-bc-form-element__label'), 'class name of label element');

	assert.ok(target.isWrappedByLabel, 'label is wrapped');

	assert.equal(target.labelText, 'beforeLabelTextafterLabelText', 'text of label');

});

QUnit.test('wrapped label - optional label', function (assert) {
	assert.expect(1);

	var $target = $('#target-wrapped-label');

	var target = new baser.Select($target[0], {
		label: 'labelFromOption'
	});

	assert.equal(target.labelText, 'labelFromOption', 'text of label');

});

QUnit.test('leaved label', function (assert) {
	assert.expect(4);

	var $target = $('#target-with-label');

	var target = new baser.Select($target[0]);

	assert.ok($(target.label).hasClass('-bc-form-element'), 'class name of label element');
	assert.ok($(target.label).hasClass('-bc-form-element__label'), 'class name of label element');

	assert.ok(!target.isWrappedByLabel, 'label is leaved');

	assert.equal(target.labelText, 'withLabel', 'text of label');

});

QUnit.test('leaved label - optional label', function (assert) {
	assert.expect(1);

	var $target = $('#target-with-label');

	var target = new baser.Select($target[0], {
		label: 'labelFromOption'
	});

	assert.equal(target.labelText, 'labelFromOption', 'text of label');

});

QUnit.test('title label - optional label', function (assert) {
	assert.expect(1);

	var $target = $('#target-title-label');

	var target = new baser.Select($target[0]);

	assert.equal(target.labelText, 'title-label', 'text of label');

});

QUnit.test('default value', function (assert) {

	var $target = $('#target-default-value');

	var target = new baser.Select($target[0]);

	assert.equal(target.defaultValue, 'default-value', 'default value');

});

QUnit.test('disabled - get', function (assert) {
	assert.expect(2);

	var $target = $('#target-disabled');

	var target = new baser.Select($target[0]);

	assert.ok(target.disabled, 'disabled is true');
	assert.ok($(target.el).hasClass('-bc-form-element--disabled'), 'class name of disabled this element');

	// フォーカスできないはず
	$(target.el).on('focus', function (assert) {
		throw new Error('focused');
	});

	$(target.el).trigger('focus');

});

QUnit.test('disabled - change', function (assert) {
	assert.expect(5);

	var $target = $('#target-disabled');

	var target = new baser.Select($target[0]);

	assert.ok(target.disabled, 'disabled is true');
	assert.ok($(target.el).hasClass('-bc-form-element--disabled'), 'class name of disabled this element');

	target.setDisabled(false);

	assert.ok(!target.disabled, 'disabled is false after changed');

	// フォーカスできる
	$(target.el).on('focus', function () {
		var $this = $(this);
		assert.ok(true, 'focus success'); // このOKにたどりつける
		assert.ok(!$this.hasClass('-bc-form-element--disabled'), 'class name of undisabled this element');
	});

	$(target.el).trigger('focus');

});

QUnit.test('disabled - change', function (assert) {
	assert.expect(5);

	var $target = $('#target-disabled');

	var target = new baser.Select($target[0]);

	assert.ok(target.disabled, 'disabled is true');
	assert.ok($(target.el).hasClass('-bc-form-element--disabled'), 'class name of disabled this element');

	target.setDisabled(false);

	assert.ok(!target.disabled, 'disabled is false after changed');

	// フォーカスできる
	$(target.el).on('focus', function () {
		var $this = $(this);
		assert.ok(true, 'focus success'); // このOKにたどりつける
		assert.ok(!$this.hasClass('-bc-form-element--disabled'), 'class name of undisabled this element');
	});

	$(target.el).trigger('focus');

});

QUnit.test('setValue (invalid value) / change event', function (assert) {
	assert.expect(0);

	var settingValue = 'setting-value';

	var $target = $('#target');

	var target = new baser.Select($target[0]);

	target.on('change', function (e) {
		assert.equal($(target.el).val(), settingValue, 'fired baserJS change');
	});

	$(target).on('change', function (e) {
		assert.equal($(target.el).val(), settingValue, 'fired jQuery change');
	});

	target.el.addEventListener('change', function (e) {
		assert.equal($(target.el).val(), settingValue, 'fired DOM change');
	});
	console.log(target.el);

	target.setValue(settingValue);

});

QUnit.test('setValue / change event', function (assert) {
	assert.expect(3);

	var settingValue = 'value2';

	var $target = $('#target');

	var target = new baser.Select($target[0]);

	target.on('change', function (e) {
		assert.equal($(target.el).val(), settingValue, 'fired baserJS change');
	});

	target.on('change', function (e) {
		assert.equal($(target.el).val(), settingValue, 'fired jQuery change');
	});

	target.on('change', function (e) {
		assert.equal($(target.el).val(), settingValue, 'fired DOM change');
	});

	target.setValue(settingValue);

});

</script>

</body>
</html>
